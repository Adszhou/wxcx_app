import{_ as a,s as e,H as t,q as s,l as i,p as l,m as n,J as o,o as d,c,w as u,n as r,f as p,a as g,d as f,t as m,h,b as _,r as k,F as v,i as y,j as b,I as C,y as P,K as U,k as w}from"./index-691f12c6.js";import{U as x}from"./upload.ec52e06b.js";const I=a({components:{Upload:x},data:()=>({isloadding:!0,sign:{},loadding:!0,indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,menus:[],detail:{balance:0,grade:{name:""},mobile:""},orderCount:{},setting:{},card_detail:null,sessionKey:"",urldata:"",isPopup:!1,avatarUrl:"",nickName:"",imageList:[],isUpload:!1}),onPullDownRefresh(){this.getData()},onLoad(a){this.isWeixin()&&(this.urldata=window.location.href),a.invitation_id&&e("invitation_id",a.invitation_id),a.referee_id&&e("referee_id",a.referee_id)},onShow(){this.getData()},methods:{changeAvatarUrl(){this.isUpload=!0},changeInfo(){this.avatarUrl=this.detail.avatarUrl,this.nickName=this.detail.nickName,this.isPopup=!0},getData(){let a=this;a.isloadding=!0,a._get("user.index/detail",{url:a.urldata},(function(e){a.detail=e.data.userInfo,a.sign=e.data.sign,a.menus=e.data.menus,a.setting=e.data.setting,a.loadding=!1,a.card_detail=e.data.cardDetail,t(),a.isloadding=!1,""!=a.urldata&&(a.jweixin=a.configWxScan(e.data.signPackage))}))},bindMobile(){this.gotoPage("/pages/user/modify-phone/modify-phone")},jumpPage(a){let e=this;e.isloadding||(a.startsWith("/")?e.gotoPage(a):e[a]())},toinvitation(a){0==a?s({title:"暂无活动"}):this.gotoPage("/pages/user/invite/invite?invitation_gift_id="+a)},scanQrcode:function(){this.gotoPage("/pages/user/scan/scan")},receipt:function(){let a=this;this.isWeixin()?a.jweixin.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(a){window.location.href=a.resultStr},error:function(a){s({title:"扫码失败，请重试"})}}):console.log("H5暂只支持公众号扫码")},getQr(a){for(var e=a.substring(a.indexOf("?")+1).split("&"),t=[],s=0;s<e.length;s++){var i=e[s].split("=");i.length<2?t[i[0]]="":t[i[0]]=i[1]}return"/pages/order/group/receipt?scene="+t.scene},getPhoneNumber(a){var e=this;if("getPhoneNumber:ok"!==a.detail.errMsg)return!1;i({title:"加载中"}),e._post("user.user/bindMobile",{session_key:e.sessionKey,encrypted_data:a.detail.encryptedData,iv:a.detail.iv},(a=>{s({title:"绑定成功"}),e.getData()}),!1,(()=>{l()}))},copyFunc(a){var e=document.createElement("input");e.value=a,document.body.appendChild(e),e.select(),e.setSelectionRange(0,e.value.length),document.execCommand("Copy"),document.body.removeChild(e),s({title:"复制成功",icon:"success",mask:!0,duration:2e3})},onChooseAvatar(a){console.log(a),this.uploadFile([a.detail.avatarUrl])},uploadFile:function(a){let e=this,t=0,s=a.length,d={token:n("token"),app_id:e.getAppId()};i({title:"图片上传中"}),a.forEach((function(a,i){o({url:e.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:a,name:"iFile",formData:d,success:function(a){let t="object"==typeof a.data?a.data:JSON.parse(a.data);1===t.code?e.imageList.push(t.data):e.showError(t.msg)},complete:function(){t++,s===t&&(l(),e.getImgsFunc(e.imageList))}})}))},getImgsFunc(a){if(a&&void 0!==a){let e=this;e.avatarUrl=a[0].file_path,e.isUpload=!1}},changeinput(a){this.nickName=a.target.value},closeFunc(a){this.isPopup=!1},subName(a){let e=this;if(e.loading)return;i({title:"加载中"});let t={avatarUrl:e.avatarUrl,nickName:a.detail.value.nickName};e.loading=!0,e._post("user.user/updateInfo",t,(function(a){e.showSuccess("修改成功",(function(){e.loading=!1,e.isPopup=!1,l(),e.getData()}),(function(a){l(),e.loading=!1,e.isPopup=!1}))}))}}},[["render",function(a,e,t,s,i,l){const n=y,o=p,x=b,I=C,F=P,N=U,D=w("Upload");return d(),c(o,{class:r(["user-index pb60",a.theme()||""]),"data-theme":a.theme()},{default:u((()=>[i.loadding?h("",!0):(d(),c(o,{key:0},{default:u((()=>[g(o,{class:"user-header pr theme-bg"},{default:u((()=>[g(o,{class:"user-header-inner"},{default:u((()=>[g(o,{class:"user-info"},{default:u((()=>[g(o,{class:"photo",onClick:l.changeInfo},{default:u((()=>[g(n,{src:i.detail.avatarUrl,mode:"aspectFill"},null,8,["src"])])),_:1},8,["onClick"]),g(o,{class:"info d-c d-c-s"},{default:u((()=>[g(o,{class:"d-c-c"},{default:u((()=>[g(o,{class:"name"},{default:u((()=>[f(m(i.detail.nickName),1)])),_:1}),i.detail.grade?(d(),c(x,{key:0,class:"ml10"},{default:u((()=>[f(m(i.detail.grade.name),1)])),_:1})):h("",!0)])),_:1}),g(o,{class:"tel d-s-c"},{default:u((()=>[g(x,{class:"f26"},{default:u((()=>[f("用户ID:"+m(i.detail.user_id),1)])),_:1}),g(x,{class:"copy-btn",onClick:e[0]||(e[0]=a=>l.copyFunc(i.detail.user_id+""))},{default:u((()=>[f("复制")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),g(o,{class:"my-order"},{default:u((()=>[g(o,{class:"order-top"},{default:u((()=>[g(o,{class:"order-title"},{default:u((()=>[f("我的订单")])),_:1}),g(o,{class:"order-all",onClick:e[1]||(e[1]=e=>a.gotoPage("/pages/order/myorder"))},{default:u((()=>[f("全部订单"),g(x,{class:"icon iconfont icon-jiantou"})])),_:1})])),_:1}),g(o,{class:"list d-a-c flex-1"},{default:u((()=>[g(o,{class:"item d-c-c d-c",onClick:e[2]||(e[2]=e=>a.gotoPage("/pages/user/my-wallet/my-wallet"))},{default:u((()=>[g(o,{class:"red_mini"},{default:u((()=>[f(m(i.detail.balance),1)])),_:1}),g(x,{class:"pt16 f28 gray3"},{default:u((()=>[f("金额"),g(x,{class:"f22 gray9"},{default:u((()=>[f("(元)")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),g(o,{class:"menu-wrap"},{default:u((()=>[g(o,{class:"order-top"},{default:u((()=>[g(o,{class:"order-title"},{default:u((()=>[f("服务功能")])),_:1})])),_:1}),g(o,{class:"group-bd f-w"},{default:u((()=>[(d(!0),_(v,null,k(i.menus,((a,e)=>(d(),_(v,{key:e},[1==a.status?(d(),c(o,{key:0,class:"item",onClick:e=>l.jumpPage(a.link_url)},{default:u((()=>[g(o,{class:"icon-round d-c-c"},{default:u((()=>[g(n,{class:"icon-round",src:a.image_url,mode:"aspectFit"},null,8,["src"])])),_:2},1024),g(x,{class:"name"},{default:u((()=>[f(m(a.title),1)])),_:2},1024)])),_:2},1032,["onClick"])):h("",!0)],64)))),128))])),_:1})])),_:1})])),_:1})),i.isPopup?(d(),_(v,{key:1},[g(o,{class:"pop-bg",onClick:e[3]||(e[3]=a=>l.closeFunc(null))}),g(o,{class:"pop-input d-c d-c-c"},{default:u((()=>[g(N,{onSubmit:l.subName},{default:u((()=>[g(o,{class:"ww100 flex-1 pop-top"},{default:u((()=>[g(x,{class:"icon iconfont icon-guanbi",onClick:e[4]||(e[4]=a=>l.closeFunc(null))}),g(o,{class:"pop-title tc"},{default:u((()=>[f("资料修改")])),_:1}),g(o,{class:"d-c-c",style:{"margin-bottom":"30rpx"}},{default:u((()=>[g(o,{class:"info-image"},{default:u((()=>[g(o,{class:"d-e-c",onClick:l.changeAvatarUrl},{default:u((()=>[g(n,{src:i.avatarUrl||"/static/login-log.jpg",mode:""},null,8,["src"])])),_:1},8,["onClick"])])),_:1})])),_:1}),g(o,{class:"input-box d-c-c"},{default:u((()=>[f(" 昵称 "),g(I,{type:"nickname",name:"nickName",value:i.nickName,onInput:l.changeinput},null,8,["value","onInput"])])),_:1})])),_:1}),g(F,{class:"d-c-c pop-btn theme-btn","form-type":"submit"},{default:u((()=>[f("确认")])),_:1})])),_:1},8,["onSubmit"])])),_:1})],64)):h("",!0),i.isUpload?(d(),c(D,{key:2,num:1,onGetImgs:l.getImgsFunc},null,8,["onGetImgs"])):h("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-07398165"]]);export{I as default};
